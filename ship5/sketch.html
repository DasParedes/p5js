<!DOCTYPE html>
<head>
	<!-- <meta http-equiv="refresh" content="30">-->
	<meta charset="utf-8">
  <style>
    #hud {
      position:absolute; 
      background-color: rgba(255, 0, 0, .5);
      width: 400px;
    }
  </style>
</head>
<body>
    <section id="window" style="">
    
      <div id="hud">
      <!--
        <div id="map" style="padding: 5px; background-color: #505050; height: 50px; width: 50px">
          nothing
        </div>
        <h2>HUD</h2>
        <button>Start</button>
        -->
      </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.14/p5.js"></script>
    <script src="unity.js"></script>
    <script src="ship.js"></script>
    <script src="keyControls.js"></script>
    <script src="prop.js"></script>
    <script src="HUD.js"></script>
    <script src="Force.js"></script>

<script>
// HUD
function setSizeHUD(x, y){
  var elem_window = document.getElementById('hud');
  elem_window.style.width = x+'px';
  elem_window.style.height = y+'px';
}


// ---------
function displayGrid(topX, topY, width, height, velocity){
    // grid of squares with regular size
    var local_scale = 50; 
    
    // grid of squares with size distorced by velocity.
    //local_scale = SCALE + velocity*2;
    
    var left_start = topX - topX%local_scale - local_scale; 
	var top_start = topY - topY%local_scale - local_scale;
	  
	fill(100);
	stroke(100);
	
	var middle_height = top_start + (height/2);
	var middle_width = left_start + (width/2);
	
	for(var i=0; i<height/2 + 100; i+= local_scale){
	    line(left_start, middle_height + i, left_start + width + 100, middle_height + i);
    	line(left_start, middle_height - i, left_start + width + 100, middle_height - i);
	}
	
	for(var j=0; j<width/2 + 100; j+= local_scale){
    	line(middle_width + j, top_start, middle_width + j, top_start + height + local_scale);
    	line(middle_width - j, top_start, middle_width - j, top_start + height + local_scale);
	}
}

var SCALE = 50;

var ship;

var controls = {};

// center the camera and the ship in the middle of the screen
var CENTER_CAMERA = true;
var FPS = 20;
  let height = 800;
  let width = 600;
  
function setup(){

  createCanvas(width, height);
  setSizeHUD(width, height);

  // obj 'ship' e a posição inicial
  ship = new Ship(width/2, height/2);
  pre_build_ship(ship, controls);
  
  frameRate(FPS);
}

var STOP = false;

function draw(){
  var copy_accel = ship.accel.copy();
  if(!STOP){
	  background(200);


    if (CENTER_CAMERA){
      push();
      translate(width/2 - ship.pos.x, height/2-ship.pos.y);

    }
	  action(ship, controls);
	  
	  ship.update();
      displayGrid(ship.pos.x-(width/2), ship.pos.y-(height/2), width, height, ship.vel.mag());
      copy_accel = ship.accel.copy();
      ship.display();

    if (CENTER_CAMERA){
      pop();
    }
  }
  
  info(ship, copy_accel);
  //STOP=true;
}

function pause(){
	STOP = !STOP;
 }

function info(obj, copy_accel){
    fill(200);
    rect(0, 0, 100, 200);
    fill(20);
    text('velocity', 25, 10);
    fill(200);
    ellipse(50, 50, 50);
    strokeWeight(2);
    line(50, 50, 50+obj.vel.x, 50+obj.vel.y);
    
    noFill();
    strokeWeight(5);
    if (obj.velAng < 0)
        arc(50, 50, 60, 60, PI/2 + obj.velAng, PI/2);
    else
    if (obj.velAng > 0)
        arc(50, 50, 60, 60, PI/2, PI/2 + obj.velAng);
    strokeWeight(1);
    
    fill(20);
    text('acceleration', 10, 100);
    fill(200);
    ellipse(50, 150, 50);
    var accel = copy_accel.copy().normalize()*50;
    line(50, 150, 50+accel.x, 150+accel.y);
}

</script>
</body>
</html>
